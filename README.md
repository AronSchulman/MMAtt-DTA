# MMAtt-DTA: MultiModal Attention Drug-Target Affinity prediction

Code repository for the work "Attention-based approach to predict drugâ€“target interactions across seven target superfamilies".

Link to article: https://doi.org/10.1093/bioinformatics/btae496

Link to master's thesis: https://urn.fi/URN:NBN:fi:aalto-202401282133

Download the data: https://zenodo.org/doi/10.5281/zenodo.10589695

Try it out! https://mmatt-dta.serve.scilifelab.se/


![workflow](https://github.com/AronSchulman/MMAtt-DTA/assets/63584295/542ffe0e-8a78-4f53-82c4-e9efedbbba06)


## Use the web server for predicting drug-target binding affinity

![webserver](https://github.com/user-attachments/assets/e76a6797-19c2-4120-9721-abce30a9d53b)

You can make direct affinity predictions for your drug-target pairs with ease online at https://mmatt-dta.serve.scilifelab.se/.

To make predictions, you need to provide a `.csv` file with the following four columns:
* smiles
* uniprot_id
* protein_class
* model_type

**Please see the** `example_input.csv` **for reference on how to create the input file.**

Make sure the entries are comma-separated (and not e.g. semicolon(;)-separated).

For best predictions, your uniprot IDs should be present in the `available_proteins.csv` file, as these 1963 proteins have both Zernike and sequence-based protein features available.

Values in the `protein_class` column should be one or more from the following: `[enzyme, epigenetic_regulator, gpcr, ion_channel, kinase, nuclear_receptor, transporter]`.

Values in the `model_type` column should be either `pchembl` or `interaction_score` depending on your preferred label type.

When you have the input file ready, upload it to the server and press 'Predict' as seen in the figure above.

Please wait fo the predictions - the wait time depends on the size of the input file. When dealing with very large data, you may consider fragmenting the data to several input files.

After execution, you can observe the predictions in the `results.csv`.



## Download the models for offline predictions

To use the models offline, you can download them from Zenodo: https://zenodo.org/doi/10.5281/zenodo.10589695. In the root of the repository, create a directory called `models`. Place the downloaded `interaction_score_models` and `pchembl_models` directories in the `models` directory.

The relevant script for users is `src/main_user_predict.py`.

Requirements:
```
pandas
numpy
torch
rdkit
```

The input file format is identical to the webserver use case.

Use the following command to run the script:
```
python main_user_predict.py -i /path/to/user_input.csv
```
You need to provide the path to your input file after the `-i` flag.

All predictions are mean values generated by an ensemble of five models. It is recommended to run the prediction on a GPU-equipped machine.

After execution, the model outputs a `model_output_predictions.csv` file in the same directory as the executed script. The file is identical to the input file, with the addition of a `prediction` column that contains the pairwise affinity predictions in pchembl or interaction score format, depending on your specification.


### Limitations

For the protein descriptors, the user is limited to the pre-calculated values found in `descriptor_data`. If the user supplies an unavailable protein, the descriptor values are filled with zeros. This is not a problem for the subclass label. However, for sequence-based and Zernike descriptors, this may negatively impact the prediction accuracy. The available proteins can be found in the `available_proteins.csv` file.

If you wish for the addition of descriptors for your proteins, do be in touch with us.

## Reproducing thesis results

For reproducing some of the results in the thesis, we provide the following scripts:
```
train.py
tune.py
test.py
LASSO_feature_selection.py
```
In addition to the previous requirements, these scripts require:
```
ray==2.6.3
hebo
sklearn
scipy
lifelines
matplotlib
seaborn
wandb
```
All the relevant data used for model training and testing are found in the Zenodo repository mentioned above.

## Problems?

Please observe the previously opened issues for some details about drug and protein featurization.
Please open an issue in case of dependency problems, bugs, and general enquiries about usage.
